$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
type: command

# Job metadata
display_name: "VulnHunter V11 Full Training - Complete Dataset Integration"
description: "VulnHunter V11 full training with complete massive dataset integration from next.txt analysis - all dependencies included"
experiment_name: "vulnhunter-v11-full-training"

# Code and environment
code: ../training
command: python vulnhunter_v11_massive_dataset_trainer.py

# Custom environment with all required packages
environment:
  conda_file: ../environments/vulnhunter_v11_full.yml
  image: mcr.microsoft.com/azureml/openmpi4.1.0-ubuntu20.04:latest

# Enhanced compute configuration for massive datasets
compute: azureml:vulnhunter-16core

# Resource allocation for massive dataset processing
resources:
  instance_count: 1

# Environment variables for massive dataset training
environment_variables:
  OMP_NUM_THREADS: "16"
  MKL_NUM_THREADS: "16"
  VULNHUNTER_CPU_CORES: "16"
  VULNHUNTER_MEMORY_GB: "128"

  # Dataset configuration
  HUGGING_FACE_CACHE_DIR: "/tmp/hf_cache"
  TRANSFORMERS_CACHE: "/tmp/transformers_cache"
  HF_HOME: "/tmp/hf_home"
  HF_DATASETS_CACHE: "/tmp/hf_datasets_cache"

  # Training optimization
  VULNHUNTER_BATCH_SIZE: "64"
  VULNHUNTER_MAX_WORKERS: "8"
  VULNHUNTER_DATASET_STREAMING: "true"

  # Memory optimization
  TOKENIZERS_PARALLELISM: "false"
  CUDA_LAUNCH_BLOCKING: "1"

  # Dataset sources configuration
  ENABLE_THE_STACK_V2: "true"
  ENABLE_SMARTBUGS: "true"
  ENABLE_SANCTUARY: "true"
  ENABLE_SOLIDIFI: "true"
  ENABLE_DEFIHACKLABS: "true"
  ENABLE_CODENET: "true"

# Job tags for comprehensive tracking
tags:
  version: "11.0.0-full-training"
  infrastructure: "16-core-Standard_E16s_v3"
  datasets: "stack-v2,smartbugs,sanctuary,solidifi,defihacklabs,codenet"
  mathematical_foundations: "category-theory,tda,quantum-gnn,differential-homology,stochastic-verification"
  total_samples: "372500+"
  total_size_gb: "6.0+"
  cores: "16"
  memory: "128GB"
  training_type: "massive-multi-source-full"
  academic_ready: "true"
  dependencies_fixed: "true"
  environment_type: "custom-conda"