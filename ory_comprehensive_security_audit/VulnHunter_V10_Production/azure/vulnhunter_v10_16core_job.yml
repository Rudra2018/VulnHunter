$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
type: command

# Job metadata
display_name: "VulnHunter V10 Optimized 16-Core Training"
description: "Revolutionary VulnHunter V10 training optimized for 16-core Standard_E16s_v3 infrastructure"
experiment_name: "vulnhunter-v10-16core-optimized"

# Code and environment
code: ../training
command: >
  python vulnhunter_v10_full_training.py
  --cores=16
  --memory=128
  --batch_size=64
  --gradient_accumulation=4
  --cpu_optimized=true
  --dataset_subset=5000000

environment:
  image: mcr.microsoft.com/azureml/curated/sklearn-1.0-ubuntu20.04-py38-cpu:latest
  conda_file: ../environments/vulnhunter_v10_cpu.yml

# Compute configuration
compute: azureml:vulnhunter-16core

# Resource allocation
resources:
  instance_count: 1
  shm_size: 8g

# Job tags for tracking
tags:
  version: "10.0.0-16core"
  model_size: "optimized-cpu"
  dataset_size: "5-million-samples"
  infrastructure: "16-core-Standard_E16s_v3"
  optimization: "cpu-memory-optimized"
  cores: "16"
  memory: "128GB"
  mathematical_foundations: "category-theory,tda,quantum-gnn,differential-homology"
  target_performance: "92-f1-3-fpr"
  scale: "cpu-optimized"

# Environment variables for optimization
environment_variables:
  OMP_NUM_THREADS: "16"
  MKL_NUM_THREADS: "16"
  OPENBLAS_NUM_THREADS: "16"
  VECLIB_MAXIMUM_THREADS: "16"
  NUMBA_NUM_THREADS: "16"
  PYTORCH_TENSORPIPE_NUMA_AWARE: "1"
  MALLOC_CONF: "background_thread:true,metadata_thp:auto,dirty_decay_ms:30000,muzzy_decay_ms:30000"
  VULNHUNTER_CPU_CORES: "16"
  VULNHUNTER_MEMORY_GB: "128"
  VULNHUNTER_OPTIMIZATION_MODE: "cpu"
  VULNHUNTER_DATASET_SUBSET: "5000000"

# Outputs
outputs:
  model_artifacts:
    type: uri_folder
    mode: rw_mount
  training_logs:
    type: uri_folder
    mode: rw_mount
  performance_metrics:
    type: uri_folder
    mode: rw_mount