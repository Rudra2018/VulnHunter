{
  "job_name": "vulnhunter-distributed-demo",
  "package_dir": "distributed_training_package",
  "job_spec": {
    "displayName": "vulnhunter-distributed-demo",
    "jobSpec": {
      "workerPoolSpecs": [
        {
          "machineSpec": {
            "machineType": "n1-standard-8",
            "acceleratorType": "NVIDIA_TESLA_T4",
            "acceleratorCount": 2
          },
          "replicaCount": 2,
          "containerSpec": {
            "imageUri": "gcr.io/deeplearning-platform-release/pytorch-gpu.1-13",
            "command": [
              "python3",
              "/app/distributed_training.py"
            ],
            "args": [
              "--config",
              "/app/training_config.json",
              "--world-size",
              "4"
            ],
            "env": [
              {
                "name": "NCCL_DEBUG",
                "value": "INFO"
              },
              {
                "name": "PYTHONUNBUFFERED",
                "value": "1"
              },
              {
                "name": "MASTER_PORT",
                "value": "12355"
              }
            ]
          }
        }
      ],
      "scheduling": {
        "timeout": "14400s",
        "restartJobOnWorkerRestart": true
      }
    }
  },
  "config": {
    "machine_type": "n1-standard-8",
    "accelerator_type": "NVIDIA_TESLA_T4",
    "accelerator_count": 2,
    "replica_count": 2,
    "batch_size_per_gpu": 16,
    "gradient_accumulation_steps": 4,
    "mixed_precision": true,
    "sync_batch_norm": true,
    "strategy": "MULTI_WORKER_MIRRORED",
    "all_reduce_alg": "RING",
    "max_runtime_seconds": 14400,
    "max_retries": 3,
    "total_gpus": 4,
    "global_batch_size": 256
  }
}